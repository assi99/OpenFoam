/*--------------------------------*- C++ -*----------------------------------*\
| =========                 |                                                 |
| \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox           |
|  \\    /   O peration     | Version: 8                                      |
|   \\  /    A nd           |                                                 |
|    \\/     M anipulation  |                                                 |
\*---------------------------------------------------------------------------*/

FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    object      snappyHexMeshDict;
}

// Switches
castellatedMesh true;
snap            true;
addLayers       true;

// Geometry
geometry
{
    solution1STLfile.stl
    {
        type triSurfaceMesh;
        name airframe;
    }
}

// CASTELLATED MESH CONTROLS
castellatedMeshControls
{
    maxLocalCells       1000000;
    maxGlobalCells      8000000;
    minRefinementCells  0;
    nCellsBetweenLevels 2;

    features
    (
        {
            file "solution1STLfile.eMesh";
            level 2;
        }
    );

    refinementSurfaces
    {
        airframe
        {
            level (3 4);

            patchInfo
            {
                type wall;
            }
        }
    }

    refinementRegions
    {
        box1
        {
            mode inside;
            levels ((1E15 2));
        }
    }

    // Inside the flow region and not inside drone geometry
    locationInMesh (2 0 0);

    resolveFeatureAngle 30;
    allowFreeStandingZoneFaces true;
}

// SNAP CONTROLS
snapControls
{
    nSmoothPatch        3;
    tolerance           2.0;
    nSolveIter          30;
    nRelaxIter          5;
    explicitFeatureSnap false;
    implicitFeatureSnap true;
    multiRegionFeatureSnap false;
}

// LAYERS CONTROLS
addLayersControls
{
    relativeSizes       true;

    layers
    {
        "airframe.*"
        {
            nSurfaceLayers 2;   // reduced to avoid crash
        }
    }

    expansionRatio      1.2;
    finalLayerThickness 0.1;   
    minThickness        0.05;
    nGrow               1;     // allows skipping

    featureAngle        60;
    nRelaxIter          5;
    nSmoothSurfaceNormals 3;
    nSmoothNormals        3;
    nSmoothThickness      10;
    maxFaceThicknessRatio 0.5;
    maxThicknessToMedialRatio 0.3;
    minMedianAxisAngle    90;
    nBufferCellsNoExtrude 0;
    nLayerIter          50;
}

// MESH QUALITY CONTROLS
meshQualityControls
{
    maxNonOrtho             65;
    maxBoundarySkewness     4;
    maxInternalSkewness     4;
    maxConcave              80;
    minVol                  1e-13;
    minTetQuality           1e-9;
    minTwist                0.02;
    minDeterminant          0.001;
    minFaceWeight           0.02;
    minVolRatio             0.01;
    minArea                 1e-13;
    minTriangleTwist        0.02;  

    nSmoothScale            4;
    errorReduction          0.75;
}

debug 0;
mergeTolerance 1e-6;

// ************************************************************************* //
